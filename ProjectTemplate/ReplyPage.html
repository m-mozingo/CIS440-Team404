<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<title></title>
	<!--DO NOT FORGET THIS SCRIPT TAG SO YOU CAN USE JQUERY!!!!!-->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

	<!--YOUR OWN JAVASCRIPT CAN GO RIGHT HERE-->
	<script type="text/javascript">
        
       
        var responseQuery;
        var accData;
        var scenText;

        function getAccount() {
            var accountText = localStorage.getItem("accountData");
            accData = JSON.parse(accountText)
            console.log(accData)
        }
        /*gets account data from the json
         is used in this page*/
        function reply() {
            var txt = document.getElementById("responseText").value
            var userID = accData[0][0]
            var scenID = scenText[0][0]
            responseQuery = "INSERT INTO `summer2020group1`.`Response`(`userResponse`, `userID`, `scenarioID`) VALUES('" + txt + "', '" + userID + "', '" + scenID + "')";
            if (txt != "") {
                console.log("not empty")
                sendReply();
                alert("Reply Sent")
                window.location.assign("HomePage.html");
            }
            else{
                console.log("text empty")
                alert("Please fill out the response text box")
            }
        }
        /*runs when the reply button is pushed 
         gets the text of the textarea element and stores it in the txt variable
         it also get the accountID/current user and the scenID 
         again this was pulled from the local json and the data was set from the log on page and the home page
         responseQuery like the others sets the txt userId and scenId to get the query ready to go to the webmethod
         the if statement checks if the txt variable is empty, and sends an alert if it is
         if it isnt then the sendReply method is called which is the function that sends the query to the 'testEditing' web method which can execute insert queries
         then alerts that the reply was sent*/

		function sendReply() {
            var webMethod = "ProjectServices.asmx/TestEditing";
            var parameters = "{\"query\":\"" + encodeURI(responseQuery) + "\"} ";

			//jQuery ajax method
			$.ajax({
				type: "POST",
				url: webMethod,
				data: parameters,
				contentType: "application/json; charset=utf-8",
				dataType: "json",
				success: function (msg) {
                    var data = msg.d;
                    console.log(data)
				},
				error: function (e) {
					alert("this code will only execute if javascript is unable to access the webservice");
				}
			});
        }
        /*the send reply is like everyother ajax method the only things changed is the parameter and the web method being called
         the responsequery is sent and somewhere I need to send the user back to the home page
         nothing is set up to deal with the return from the web method as long as it isnt an error message it most likely went through*/

        window.onload = function () {
            getAccount();
            var scenBox = document.getElementById("scenText");
            var jsonText = localStorage.getItem("scenario");
            scenText = JSON.parse(jsonText)
            console.log(scenText);
            scenBox.innerHTML = scenText[1];
        }
        /*onload once again sets the scen text as you saw before so the user can still see the scenario text*/
	</script>
	<!--END OF YOUR OWN JAVASCRIPT-->

	<!--AND YOUR OWN CSS CAN GO HERE AS WELL-->
	<style>
        * {
			box-sizing: 		border-box;
		}

		/* For phones (portrait) unless another @media rule below is fired */
		@media only screen and (max-width: 500px) {
			.col-sm-00  {display: 		   none; }
            .col-sm-06  {width: 		    50%; }
			.col-sm-12 	{width: 		   100%; }
			body 		{background-color: grey;}
			
		}

		/* For medium screens (e.g. landscape phones and portrait tablets) */
		@media only screen and (min-width: 501px) {
			.col-md-00  {display: 		   none; }
			.col-md-01  {width: 		  8.33%; }
			.col-md-02  {width: 		 16.66%; }
			.col-md-03  {width: 		 25.00%; }
			.col-md-04  {width: 		 33.33%; }
			.col-md-05  {width: 		 41.66%; }
			.col-md-06  {width: 		 50.00%; }
			.col-md-07  {width: 		 58.33%; }
			.col-md-08  {width: 		 66.66%; }
			.col-md-09  {width: 		 75.00%; }
			.col-md-10  {width: 		 83.33%; }
			.col-md-11  {width: 		 91.66%; }
			.col-md-12  {width: 		100.00%; }
			body 		{background-color: lightgrey;}
			
		}

		/* For large screens or landscape tablets*/		
		@media only screen and (min-width: 1024px) {
			.col-md-00  {display: 		initial; }
			.col-sm-00  {display:       initial; }
			.col-lg-01  {width: 		  8.33%; }
			.col-lg-02  {width: 		 16.66%; }
			.col-lg-03  {width: 		 25.00%; }
			.col-lg-04  {width: 		 33.33%; }
			.col-lg-05  {width: 		 41.66%; }
			.col-lg-06  {width: 		 50.00%; }
			.col-lg-07  {width: 		 58.33%; }
			.col-lg-08  {width: 		 66.66%; }
			.col-lg-09  {width: 		 75.00%; }
			.col-lg-10 	{width: 		 83.33%; }
			.col-lg-11 	{width: 		 91.66%; }
			.col-lg-12 	{width: 		100.00%; }
			body 		{background-color: white;}
			
		}

		[class*="col-"] {
			float: 				left;
			
		}

		.row::after {
			content: 			"";
			clear: 				both;
			display: 			block;
		}

		body {
			font-family: 		sans-serif;
			font-size: 			12px;		
			text-align: 		center;
		}

        .top {
            height: 30vh;
            border: solid 2px black;
            border-radius: 10px;
        }

        .bottom {
            height: 50vh;
            border: solid 2px black;
            border-radius: 10px;
        }
        #replyButton{margin-left:80%; width:80px;}
	</style>
	<!--END OF YOUR OWN CSS-->
</head >
<body>
   
    <div class="row">
        <h1>Scenario:</h1>
        <textarea class="top col-lg-12 col-md-12 col-sm-12" id="scenText" disabled> </textarea>
        
    </div>
    <div class="row">
        <h1>Your Response:</h1>
        <textarea class="bottom col-lg-12 col-md-12 col-sm-12" id="responseText"></textarea>
        <button onclick="javascript: reply()" id="replyButton">Send</button>
    </div>
</body>
</html >
